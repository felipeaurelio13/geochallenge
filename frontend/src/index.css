@tailwind base;
@tailwind components;
@tailwind utilities;

/*
  Design tokens globales (mobile-first)
  -------------------------------------------------
  --colors-*      Paleta semántica de superficie, texto y estados.
  --spacing-*     Escala de espaciado para padding, gaps y tamaños mínimos táctiles.
  --radii-*       Radios consistentes para tarjetas, controles y chips.
  --shadows-*     Elevaciones suaves para separar planos visuales.
  --breakpoints-* Referencia central de cortes responsive (sin hardcode disperso).
*/
:root {
  color-scheme: light dark;

  /* Colors */
  --color-bg-app: #f8fafc;
  --color-bg-shell: #e2e8f0;
  --color-surface: #ffffff;
  --color-surface-muted: #f1f5f9;
  --color-border: #cbd5e1;
  --color-text-primary: #0f172a;
  --color-text-secondary: #475569;
  --color-text-muted: #64748b;

  --color-primary-50: #eff6ff;
  --color-primary-100: #dbeafe;
  --color-primary-200: #bfdbfe;
  --color-primary-300: #93c5fd;
  --color-primary-400: #60a5fa;
  --color-primary-500: #3b82f6;
  --color-primary-600: #2563eb;
  --color-primary-700: #1d4ed8;
  --color-primary-800: #1e40af;
  --color-primary-900: #1e3a8a;

  --color-success-500: #22c55e;
  --color-success-600: #16a34a;
  --color-warning-500: #eab308;
  --color-error-500: #ef4444;
  --color-error-600: #dc2626;

  /* Spacing */
  --space-0: 0rem;
  --space-0_5: 0.125rem;
  --space-1: 0.25rem;
  --space-1_5: 0.375rem;
  --space-2: 0.5rem;
  --space-2_5: 0.625rem;
  --space-3: 0.75rem;
  --space-3_5: 0.875rem;
  --space-4: 1rem;
  --space-5: 1.25rem;
  --space-6: 1.5rem;
  --space-8: 2rem;
  --space-10: 2.5rem;
  --space-12: 3rem;
  --space-16: 4rem;
  --space-15: 3.75rem;
  --space-25: 6.25rem;

  --map-height-min: 12.5rem;
  --map-height-fluid: 34dvh;
  --map-height-max: 19rem;
  --option-min-h: 2.75rem;
  --option-min-h-sm: 3.25rem;
  --font-size-2xs: 0.6875rem;

  /* Radii */
  --radius-sm: 0.5rem;
  --radius-md: 0.75rem;
  --radius-lg: 1rem;
  --radius-xl: 1.25rem;
  --radius-2xl: 1.5rem;
  --radius-3xl: 1.875rem;
  --radius-pill: 9999px;

  /* Shadows */
  --shadow-sm: 0 1px 2px rgb(15 23 42 / 0.12);
  --shadow-md: 0 6px 12px rgb(15 23 42 / 0.18);
  --shadow-lg: 0 12px 28px rgb(15 23 42 / 0.24);
  --shadow-glow-primary: 0 0 0.375rem rgb(59 130 246 / 0.45);

  /* Breakpoints */
  --breakpoint-xs: 30rem;
  --breakpoint-sm: 40rem;
  --breakpoint-md: 48rem;
  --breakpoint-lg: 64rem;
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-bg-app: #020617;
    --color-bg-shell: #030712;
    --color-surface: #111827;
    --color-surface-muted: #1f2937;
    --color-border: #374151;
    --color-text-primary: #f8fafc;
    --color-text-secondary: #cbd5e1;
    --color-text-muted: #94a3b8;
  }
}

@layer base {
  html,
  body {
    margin: var(--space-0);
    padding: var(--space-0);
    height: 100%;
    overflow: hidden;
    overscroll-behavior: none;
  }

  html {
    @apply scroll-smooth;
    background-color: var(--color-bg-shell);
  }

  body {
    background-color: var(--color-bg-app);
    color: var(--color-text-primary);
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
  }

  #root {
    height: 100%;
  }

  * {
    -webkit-tap-highlight-color: transparent;
  }

  button:focus-visible,
  a:focus-visible,
  input:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px var(--color-primary-400);
  }
}

@layer components {
  .app-root {
    height: 100%;
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    padding-top: 0;
    padding-right: env(safe-area-inset-right);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    background-color: var(--color-bg-shell);
  }

  .screen {
    @apply flex h-full min-h-0 flex-1 flex-col;
  }

  .screen-header,
  .screen-footer {
    flex: 0 0 auto;
  }

  .screen-content {
    @apply flex min-h-0 flex-1 flex-col;
    overflow: hidden;
  }

  .universal-layout {
    display: grid;
    grid-template-rows: auto minmax(0, 1fr) auto;
    height: 100dvh;
    min-height: 100dvh;
    min-width: 0;
    background-color: var(--color-surface);
    overflow: hidden;
    overscroll-behavior: none;
  }

  .layout-header {
    z-index: 20;
    padding-top: env(safe-area-inset-top);
    min-width: 0;
  }

  .layout-header > :first-child {
    min-width: 0;
  }

  .layout-progress {
    min-width: 0;
  }

  .content-area {
    min-width: 0;
    min-height: 0;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    padding: 0 var(--space-4) var(--space-3);
  }

  .layout-footer {
    z-index: 30;
    min-width: 0;
  }

  .game-round-content {
    gap: clamp(var(--space-1_5), 1.4dvh, var(--space-2_5));
    padding-top: clamp(var(--space-1), 0.8dvh, var(--space-1_5));
    padding-bottom: clamp(var(--space-1), 0.8dvh, var(--space-1_5));
  }

  .game-question-wrap {
    min-width: 0;
  }

  .game-question-wrap--capital {
    align-items: center;
  }

  .game-question-wrap--media {
    flex: 0 0 auto;
  }

  .game-options-wrap {
    display: grid;
    align-content: stretch;
  }

  .game-question-wrap--media + .game-options-wrap {
    grid-template-rows: minmax(0, 1fr);
  }

  .game-options-grid {
    display: grid;
    grid-template-rows: repeat(4, minmax(0, 1fr));
    gap: clamp(var(--space-1_5), 1.3dvh, var(--space-2));
  }

  .question-card {
    width: 100%;
  }

  .question-card--with-media {
    width: 100%;
  }

  .media-box {
    width: 100%;
    aspect-ratio: 16 / 9;
    height: auto;
    max-height: 28dvh;
    display: block;
  }

  .media-box--compact {
    max-height: 26dvh;
  }

  .media-box--silhouette {
    max-width: 100%;
  }


  @media (max-height: 830px) {
    .game-round-content {
      gap: clamp(var(--space-1), 1dvh, var(--space-1_5));
    }

    .game-options-grid {
      gap: clamp(var(--space-1), 1dvh, var(--space-1_5));
    }

    .media-box {
      max-height: 24dvh;
    }
  }
  .app-shell {
    background-color: var(--color-bg-shell);
    color: var(--color-text-primary);
    @apply flex h-full min-h-0 flex-col overflow-hidden;
    min-width: 0;
  }

  .surface-panel {
    border: 1px solid var(--color-border);
    background-color: color-mix(in srgb, var(--color-surface) 92%, transparent);
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-sm);
  }

  .app-footer {
    border-top: 1px solid var(--color-border);
    padding: var(--space-4);
    text-align: center;
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }

  .app-footer__version {
    margin-top: var(--space-1);
    display: inline-flex;
    border-radius: var(--radius-pill);
    border: 1px solid var(--color-border);
    background-color: var(--color-surface);
    padding: var(--space-0_5) var(--space-2);
    font-size: var(--font-size-2xs);
    color: var(--color-text-secondary);
  }

  .skip-link {
    @apply sr-only focus:not-sr-only focus:absolute focus:left-3 focus:top-3 focus:z-50 focus:rounded-lg focus:px-3 focus:py-2 focus:text-sm;
    background-color: var(--color-surface);
    color: var(--color-text-primary);
    box-shadow: 0 0 0 2px var(--color-primary-400);
  }

  .timer-ring-bg {
    stroke: var(--color-border);
  }

  .text-score-label {
    font-size: var(--font-size-2xs);
  }

  .text-2xs-token {
    font-size: var(--font-size-2xs);
  }

  .min-w-rank {
    min-width: var(--space-15);
  }

  .min-w-chip {
    min-width: var(--space-25);
  }

  .option-button-base {
    min-height: var(--option-min-h);
    padding-top: clamp(var(--space-1_5), 1.2dvh, var(--space-3));
    padding-bottom: clamp(var(--space-1_5), 1.2dvh, var(--space-3));
  }

  .map-surface {
    border: 2px solid color-mix(in srgb, var(--color-border) 85%, transparent);
    background-color: color-mix(in srgb, var(--color-surface) 25%, transparent);
    box-shadow: var(--shadow-sm);
  }

  .map-surface :global(.leaflet-top.leaflet-left),
  .map-surface .leaflet-top.leaflet-left {
    margin-top: var(--space-2_5);
    margin-left: var(--space-2_5);
  }

  .map-surface :global(.leaflet-bottom.leaflet-right),
  .map-surface .leaflet-bottom.leaflet-right {
    margin-right: var(--space-2_5);
    margin-bottom: var(--space-2_5);
  }

  .map-surface :global(.leaflet-control-attribution),
  .map-surface .leaflet-control-attribution {
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    background-color: color-mix(in srgb, var(--color-surface) 92%, transparent);
    color: var(--color-text-secondary);
    padding: var(--space-1) var(--space-2);
  }
}

@media (min-width: 40rem) {
  .option-button-base {
    min-height: var(--option-min-h-sm);
  }
}

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    scroll-behavior: auto !important;
    transition-duration: 0.01ms !important;
  }
}

@layer utilities {
  .text-shadow {
    text-shadow: 0 0.125rem 0.25rem rgb(0 0 0 / 0.5);
  }

  .active\:scale-98:active {
    transform: scale(0.98);
  }
}

@keyframes countdown {
  from { stroke-dashoffset: 0; }
  to { stroke-dashoffset: 283; }
}

.timer-circle { animation: countdown linear forwards; }

@keyframes scorePopup {
  0% { opacity: 0; transform: translateY(0.625rem) scale(0.8); }
  50% { opacity: 1; transform: translateY(-0.625rem) scale(1.1); }
  100% { opacity: 0; transform: translateY(-1.875rem) scale(1); }
}

.score-popup { animation: scorePopup 1s ease-out forwards; }

@keyframes confetti {
  0% { opacity: 1; transform: translateY(0) rotate(0deg); }
  100% { opacity: 0; transform: translateY(100dvh) rotate(720deg); }
}
