generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String      @id @default(cuid())
  username          String      @unique
  email             String      @unique
  passwordHash      String
  preferredLanguage String      @default("es")
  highScore         Int         @default(0)
  gamesPlayed       Int         @default(0)
  wins              Int         @default(0)
  losses            Int         @default(0)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  // Relaciones
  games              GameResult[]
  challengesSent     Challenge[]  @relation("ChallengeSent")
  challengesReceived Challenge[]  @relation("ChallengeReceived")

  @@map("users")
}

model Question {
  id             String   @id @default(cuid())
  category       Category
  questionData   String   // Nombre del país/ciudad o prompt
  options        String[] // Opciones para múltiple choice
  correctAnswer  String
  imageUrl       String?  // URL de bandera o silueta
  latitude       Float?   // Para preguntas de mapa
  longitude      Float?   // Para preguntas de mapa
  continent      String?  // Para generar distractores regionales
  difficulty     Difficulty @default(MEDIUM)
  createdAt      DateTime @default(now())

  @@map("questions")
}

model GameResult {
  id            String   @id @default(cuid())
  userId        String
  score         Int
  correctCount  Int
  totalQuestions Int
  category      Category?
  gameMode      GameMode @default(SINGLE)
  details       Json?    // Desglose de respuestas
  createdAt     DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("game_results")
}

model Challenge {
  id              String          @id @default(cuid())
  challengerId    String
  challengedId    String
  status          ChallengeStatus @default(PENDING)
  category        Category?
  questionIds     String[]        // IDs de preguntas para reproducibilidad
  challengerScore Int?
  challengedScore Int?
  winnerId        String?
  createdAt       DateTime        @default(now())
  expiresAt       DateTime
  completedAt     DateTime?

  challenger User @relation("ChallengeSent", fields: [challengerId], references: [id], onDelete: Cascade)
  challenged User @relation("ChallengeReceived", fields: [challengedId], references: [id], onDelete: Cascade)

  @@map("challenges")
}

enum Category {
  MAP
  FLAG
  CAPITAL
  SILHOUETTE
  MIXED
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum GameMode {
  SINGLE
  DUEL
  CHALLENGE
}

enum ChallengeStatus {
  PENDING
  ACCEPTED
  COMPLETED
  EXPIRED
  DECLINED
}
